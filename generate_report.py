import json
import pandas as pd
import os

# Cargar los resultados del escaneo
with open('results.json') as f:
    data = json.load(f)

# Extraer las vulnerabilidades
vulnerabilities = []
repo_url = os.getenv('REPO_URL')

for match in data['matches']:
    vuln = match['vulnerability']
    vulnerabilities.append({
        'Repository': repo_url,
        'Vulnerability': vuln['id']
    })

# Crear un DataFrame y guardarlo en un archivo Excel
df = pd.DataFrame(vulnerabilities)
df.to_excel('vulnerabilities_report.xlsx', index=False)
